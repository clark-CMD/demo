// ==UserScript==
// @name         Shanbay Safari Reader Mode
// @namespace    http://tampermonkey.net/
// @version      0.1
// @description  Make Shanbay website compatible with Safari's Reader Mode
// @author       You
// @match        https://web.shanbay.com/reading/web-news/articles/*
// @grant        none
// ==/UserScript==

(function() {
    'use strict';
    
    // Function to run when the page is loaded
    function enhanceForReaderMode() {
        // Get the main article content
        const articleTitle = document.querySelector('h1, .article-title');
        const articleContent = document.querySelector('.article-content');
        
        if (!articleTitle || !articleContent) {
            console.log('Could not find article elements');
            return;
        }
        
        // Create article element if it doesn't exist
        let articleElement = document.querySelector('article');
        if (!articleElement) {
            articleElement = document.createElement('article');
            
            // Find a good place to insert the article element
            const contentContainer = articleContent.parentElement;
            if (contentContainer) {
                contentContainer.parentNode.insertBefore(articleElement, contentContainer);
                articleElement.appendChild(contentContainer);
            } else {
                // Fallback: wrap the article content
                articleContent.parentNode.insertBefore(articleElement, articleContent);
                articleElement.appendChild(articleContent);
            }
        }
        
        // Ensure there's a proper heading structure
        if (articleTitle && !articleElement.contains(articleTitle)) {
            articleElement.insertBefore(articleTitle, articleElement.firstChild);
        }
        
        // Add proper semantic attributes
        articleElement.setAttribute('role', 'article');
        articleElement.setAttribute('aria-labelledby', 'article-title');
        
        // Add additional semantic markup
        if (articleTitle) {
            articleTitle.id = 'article-title';
            articleTitle.setAttribute('itemprop', 'headline');
        }
        
        if (articleContent) {
            articleContent.setAttribute('itemprop', 'articleBody');
        }
        
        console.log('Enhanced page for Safari Reader Mode');
    }
    
    // Run the function after page has loaded
    window.addEventListener('load', enhanceForReaderMode);
    
    // Also try running it immediately in case the page is already loaded
    enhanceForReaderMode();
})();
